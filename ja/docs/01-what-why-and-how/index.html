<!doctype html><html lang=ja dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="何を、なぜ、どのように # WebRTCとは？ # WebRTC とは、Web Real-Time Communication の略で、API であると同時にプロトコルでもあります。WebRTC プロトコルは、2 つの WebRTC エージェントが双方向の安全なリアルタイム通信をネゴシエートするための一連のルールです。WebRTC API は、開発者が WebRTC プロトコルを使用するためのものです。WebRTC API は、JavaScript のみで規定されています。
似たような関係として、HTTP と fetch API があります。プロトコルとしての WebRTC が HTTP で、API としての WebRTC が fetch API となります。
WebRTC プロトコルは、JavaScript 以外の API/言語でも利用可能です。また、WebRTC 用のサーバーやドメイン固有のツールもあります。これらの実装はすべて WebRTC プロトコルを使用しているため、相互にやりとりできます。
WebRTC プロトコルは、IETF のrtcwebというワーキンググループで管理されています。WebRTC API は、W3C のwebrtcで文書化されています。
なぜWebRTCを学ぶ必要があるのか？ # WebRTC を使うことで得られるものは以下の通りです。このリストはすべてを網羅しているわけではありませんが、あなたが旅をしている間に感謝することもあるでしょう。これらの用語のいくつかをまだ知らなくても、この本が教えてくれますのでご安心ください。
オープンスタンダード 複数の実装 ブラウザで利用可能 必須の暗号化 NAT トラバーサル 既存技術の再利用 輻輳（ふくそう）制御 1秒未満のレイテンシー WebRTCプロトコルは他の技術の集合体である # これは、本 1 冊分の説明が必要なテーマです。しかし、ここでは 4 つのステップに分けて説明します。"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://webrtcforthecurious.com/ja/docs/01-what-why-and-how/"><meta property="og:site_name" content="好奇心旺盛な人のためのWebRTC"><meta property="og:title" content="何を、なぜ、どのように"><meta property="og:description" content="何を、なぜ、どのように # WebRTCとは？ # WebRTC とは、Web Real-Time Communication の略で、API であると同時にプロトコルでもあります。WebRTC プロトコルは、2 つの WebRTC エージェントが双方向の安全なリアルタイム通信をネゴシエートするための一連のルールです。WebRTC API は、開発者が WebRTC プロトコルを使用するためのものです。WebRTC API は、JavaScript のみで規定されています。
似たような関係として、HTTP と fetch API があります。プロトコルとしての WebRTC が HTTP で、API としての WebRTC が fetch API となります。
WebRTC プロトコルは、JavaScript 以外の API/言語でも利用可能です。また、WebRTC 用のサーバーやドメイン固有のツールもあります。これらの実装はすべて WebRTC プロトコルを使用しているため、相互にやりとりできます。
WebRTC プロトコルは、IETF のrtcwebというワーキンググループで管理されています。WebRTC API は、W3C のwebrtcで文書化されています。
なぜWebRTCを学ぶ必要があるのか？ # WebRTC を使うことで得られるものは以下の通りです。このリストはすべてを網羅しているわけではありませんが、あなたが旅をしている間に感謝することもあるでしょう。これらの用語のいくつかをまだ知らなくても、この本が教えてくれますのでご安心ください。
オープンスタンダード 複数の実装 ブラウザで利用可能 必須の暗号化 NAT トラバーサル 既存技術の再利用 輻輳（ふくそう）制御 1秒未満のレイテンシー WebRTCプロトコルは他の技術の集合体である # これは、本 1 冊分の説明が必要なテーマです。しかし、ここでは 4 つのステップに分けて説明します。"><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-02-24T19:51:48+08:00"><title>何を、なぜ、どのように | 好奇心旺盛な人のためのWebRTC</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=canonical href=https://webrtcforthecurious.com/ja/docs/01-what-why-and-how/><link rel=alternate hreflang=en href=https://webrtcforthecurious.com/docs/01-what-why-and-how/ title="What, Why and How"><link rel=alternate hreflang=sv href=https://webrtcforthecurious.com/sv/docs/01-what-why-and-how/ title="Vad, varför och hur"><link rel=alternate hreflang=ru href=https://webrtcforthecurious.com/ru/docs/01-what-why-and-how/ title="Что, Зачем и как ?"><link rel=alternate hreflang=zh href=https://webrtcforthecurious.com/zh/docs/01-what-why-and-how/ title=是什么，为什么，如何使用><link rel=alternate hreflang=fa href=https://webrtcforthecurious.com/fa/docs/01-what-why-and-how/ title="چه چیزی، چرا و چگونه"><link rel=alternate hreflang=fr href=https://webrtcforthecurious.com/fr/docs/01-what-why-and-how/ title="Quoi, Pourquoi et Comment"><link rel=alternate hreflang=id href=https://webrtcforthecurious.com/id/docs/01-what-why-and-how/ title="Apa, Mengapa, dan Bagaimana"><link rel=alternate hreflang=es href=https://webrtcforthecurious.com/es/docs/01-what-why-and-how/ title="¿Qué, Por qué y Cómo?"><link rel=alternate hreflang=tr href=https://webrtcforthecurious.com/tr/docs/01-what-why-and-how/ title="Ne, Neden ve Nasıl"><link rel=alternate hreflang=ko href=https://webrtcforthecurious.com/ko/docs/01-what-why-and-how/ title="무엇, 왜, 어떻게?"><link rel=stylesheet href=/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css integrity="sha256-MJt+0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/ja.search.min.b65272d5bf660afe8aa74038f8c9e7bbfcffaf9f174aa08435c489e245616282.js integrity="sha256-tlJy1b9mCv6Kp0A4+Mnnu/z/r58XSqCENcSJ4kVhYoI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/ja/><span>好奇心旺盛な人のためのWebRTC</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=検索 aria-label=検索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class="flex justify-between"><a role=button class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
日本語</a></label><ul><li><a href=https://webrtcforthecurious.com/docs/01-what-why-and-how/>English</a></li><li><a href=https://webrtcforthecurious.com/ru/docs/01-what-why-and-how/>Русский</a></li><li><a href=https://webrtcforthecurious.com/sv/docs/01-what-why-and-how/>Svenska</a></li><li><a href=https://webrtcforthecurious.com/zh/docs/01-what-why-and-how/>简体中文</a></li><li><a href=https://webrtcforthecurious.com/fa/docs/01-what-why-and-how/>Persian</a></li><li><a href=https://webrtcforthecurious.com/fr/docs/01-what-why-and-how/>Français</a></li><li><a href=https://webrtcforthecurious.com/id/docs/01-what-why-and-how/>Bahasa Indonesia</a></li><li><a href=https://webrtcforthecurious.com/es/docs/01-what-why-and-how/>Español</a></li><li><a href=https://webrtcforthecurious.com/tr/docs/01-what-why-and-how/>Türkçe</a></li><li><a href=https://webrtcforthecurious.com/ko/docs/01-what-why-and-how/>한국어</a></li></ul></li></ul><ul><li><a href=/ja/docs/01-what-why-and-how/ class=active>何を、なぜ、どのように</a></li><li><a href=/ja/docs/02-signaling/>シグナリング</a></li><li><a href=/ja/docs/03-connecting/>接続</a></li><li><a href=/ja/docs/04-securing/>セキュリティ対策</a></li><li><a href=/ja/docs/05-real-time-networking/>リアルタイム・ネットワーキング</a></li><li><a href=/ja/docs/06-media-communication/>メディア・コミュニケーション</a></li><li><a href=/ja/docs/07-data-communication/>データ・コミュニケーション</a></li><li><a href=/ja/docs/08-applied-webrtc/>応用WebRTC</a></li><li><a href=/ja/docs/09-debugging/>デバッグ</a></li><li><a href=/ja/docs/10-history-of-webrtc/>歴史</a></li><li><a href=/ja/docs/11-faq/>FAQ</a></li><li><a href=/ja/docs/12-glossary/>用語集</a></li><li><a href=/ja/docs/13-reference/>参考文献</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>何を、なぜ、どのように</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#webrtcとは>WebRTCとは？</a></li><li><a href=#なぜwebrtcを学ぶ必要があるのか>なぜWebRTCを学ぶ必要があるのか？</a></li><li><a href=#webrtcプロトコルは他の技術の集合体である>WebRTCプロトコルは他の技術の集合体である</a><ul><li><a href=#シグナリング-webrtcでピアがお互いを見つける方法>シグナリング: WebRTCでピアがお互いを見つける方法</a></li><li><a href=#stunturn-による接続と-nat-トラバーサル>STUN/TURN による接続と NAT トラバーサル</a></li><li><a href=#dtls-と-srtp-によるトランスポート層のセキュリティ確保>DTLS と SRTP によるトランスポート層のセキュリティ確保</a></li><li><a href=#rtp-および-sctp-によるピアとの通信>RTP および SCTP によるピアとの通信</a></li></ul></li><li><a href=#プロトコルの集合体であるwebrtc>プロトコルの集合体であるWebRTC</a></li><li><a href=#webrtc-api-はどのように動作するか>WebRTC (API) はどのように動作するか</a><ul><li><a href=#new-rtcpeerconnection><code>new RTCPeerConnection</code></a></li><li><a href=#addtrack><code>addTrack</code></a></li><li><a href=#createdatachannel><code>createDataChannel</code></a></li><li><a href=#createoffer><code>createOffer</code></a></li><li><a href=#setlocaldescription><code>setLocalDescription</code></a></li><li><a href=#setremotedescription><code>setRemoteDescription</code></a></li><li><a href=#addicecandidate><code>addIceCandidate</code></a></li><li><a href=#ontrack><code>ontrack</code></a></li><li><a href=#oniceconnectionstatechange><code>oniceconnectionstatechange</code></a></li><li><a href=#onconnectionstatechange><code>onconnectionstatechange</code></a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=何をなぜどのように>何を、なぜ、どのように
<a class=anchor href=#%e4%bd%95%e3%82%92%e3%81%aa%e3%81%9c%e3%81%a9%e3%81%ae%e3%82%88%e3%81%86%e3%81%ab>#</a></h1><h2 id=webrtcとは>WebRTCとは？
<a class=anchor href=#webrtc%e3%81%a8%e3%81%af>#</a></h2><p>WebRTC とは、Web Real-Time Communication の略で、API であると同時にプロトコルでもあります。WebRTC プロトコルは、2 つの WebRTC エージェントが双方向の安全なリアルタイム通信をネゴシエートするための一連のルールです。WebRTC API は、開発者が WebRTC プロトコルを使用するためのものです。WebRTC API は、JavaScript のみで規定されています。</p><p>似たような関係として、HTTP と fetch API があります。プロトコルとしての WebRTC が HTTP で、API としての WebRTC が fetch API となります。</p><p>WebRTC プロトコルは、JavaScript 以外の API/言語でも利用可能です。また、WebRTC 用のサーバーやドメイン固有のツールもあります。これらの実装はすべて WebRTC プロトコルを使用しているため、相互にやりとりできます。</p><p>WebRTC プロトコルは、IETF の<a href=https://datatracker.ietf.org/wg/rtcweb/documents/>rtcweb</a>というワーキンググループで管理されています。WebRTC API は、W3C の<a href=https://www.w3.org/TR/webrtc/>webrtc</a>で文書化されています。</p><h2 id=なぜwebrtcを学ぶ必要があるのか>なぜWebRTCを学ぶ必要があるのか？
<a class=anchor href=#%e3%81%aa%e3%81%9cwebrtc%e3%82%92%e5%ad%a6%e3%81%b6%e5%bf%85%e8%a6%81%e3%81%8c%e3%81%82%e3%82%8b%e3%81%ae%e3%81%8b>#</a></h2><p>WebRTC を使うことで得られるものは以下の通りです。このリストはすべてを網羅しているわけではありませんが、あなたが旅をしている間に感謝することもあるでしょう。これらの用語のいくつかをまだ知らなくても、この本が教えてくれますのでご安心ください。</p><ul><li>オープンスタンダード</li><li>複数の実装</li><li>ブラウザで利用可能</li><li>必須の暗号化</li><li>NAT トラバーサル</li><li>既存技術の再利用</li><li>輻輳（ふくそう）制御</li><li>1秒未満のレイテンシー</li></ul><h2 id=webrtcプロトコルは他の技術の集合体である>WebRTCプロトコルは他の技術の集合体である
<a class=anchor href=#webrtc%e3%83%97%e3%83%ad%e3%83%88%e3%82%b3%e3%83%ab%e3%81%af%e4%bb%96%e3%81%ae%e6%8a%80%e8%a1%93%e3%81%ae%e9%9b%86%e5%90%88%e4%bd%93%e3%81%a7%e3%81%82%e3%82%8b>#</a></h2><p>これは、本 1 冊分の説明が必要なテーマです。しかし、ここでは 4 つのステップに分けて説明します。</p><ul><li>シグナリング</li><li>接続</li><li>セキュリティの確保</li><li>通信</li></ul><p>この 4 つのステップは順番に行われます。前のステップが 100％成功しなければ、次のステップは始まりません。</p><p>WebRTC の特徴の一つは、各ステップが実のところ他の多くのプロトコルによって構成されているということです。WebRTC を形作るために、多くの既存技術が組み合わされています。そういった意味で、WebRTC は 2000 年代初頭から存在する、よく理解された技術を組み合わせて構成したものと言えます。</p><p>これらのステップはそれぞれ専用の章を設けていますが、まずは大まかに理解しておくと便利です。これらの手順はお互いに依存しているため、それぞれの手順の目的をさらに説明する際に役立ちます。</p><h3 id=シグナリング-webrtcでピアがお互いを見つける方法>シグナリング: WebRTCでピアがお互いを見つける方法
<a class=anchor href=#%e3%82%b7%e3%82%b0%e3%83%8a%e3%83%aa%e3%83%b3%e3%82%b0-webrtc%e3%81%a7%e3%83%94%e3%82%a2%e3%81%8c%e3%81%8a%e4%ba%92%e3%81%84%e3%82%92%e8%a6%8b%e3%81%a4%e3%81%91%e3%82%8b%e6%96%b9%e6%b3%95>#</a></h3><p>WebRTC エージェントが起動したとき、WebRTC エージェントは誰と何の通信をするのかを知りません。この問題を解決するのがシグナリングです。シグナリングは、2 つの WebRTC エージェントが通信を開始できるようにするために使用されます。</p><p>シグナリングは、既存のプロトコルである SDP（Session Description Protocol）を使用します。SDP はプレーンテキストのプロトコルです。各 SDP メッセージは、キー／バリューペアで構成され、「メディアセクション」のリストを含んでいます。2 つの WebRTC エージェント間で交換する SDP には、以下のような詳細情報が含まれています。</p><ul><li>エージェントが到達可能な IP およびポート (候補)</li><li>エージェントが送信しようとしているオーディオおよびビデオトラックの数</li><li>各エージェントがサポートするオーディオおよびビデオコーデック</li><li>接続時に使用される値 (uFrag/uPwd)</li><li>セキュリティ確保時に使用される値 (証明書のフィンガープリント)</li></ul><p>シグナリングは通常 WebRTC プロトコルの与り知らないところで行われることに注意してください。つまり、アプリケーションは通常、WebRTC 自体を使用してシグナリングメッセージを交換することはありません。接続しようとしているピア間ではメッセージの送信に適するような任意のアーキテクチャを使用して SDP を中継することができ、多くのアプリケーションは既存のインフラストラクチャ (REST エンドポイント、WebSocket 接続、または認証プロキシなど) を使用して、適切なクライアント間で SDP を円滑に交換できるようにしています。</p><h3 id=stunturn-による接続と-nat-トラバーサル>STUN/TURN による接続と NAT トラバーサル
<a class=anchor href=#stunturn-%e3%81%ab%e3%82%88%e3%82%8b%e6%8e%a5%e7%b6%9a%e3%81%a8-nat-%e3%83%88%e3%83%a9%e3%83%90%e3%83%bc%e3%82%b5%e3%83%ab>#</a></h3><p>これで、2 つの WebRTC Agent は、お互いに接続を試みるのに十分な詳細を知ることができました。WebRTC は ICE という別の確立された技術を使用します。</p><p>ICE（Interactive Connectivity Establishment）は、WebRTC よりも前のプロトコルです。ICE では、2 つの Agent 間で接続を確立できます。これらの Agent は、同じネットワーク上にある場合もあれば、地球の反対側にある場合もあります。ICE は、中央のサーバーを使わずに直接接続を確立するためのソリューションです。</p><p>それを可能にしているのは、「NAT トラバーサル」と「STUN/TURN サーバー」です。この 2 つの概念があれば、別のサブネットにいる ICE エージェントと通信できます。これらのトピックについては、後ほど詳しく説明します。</p><p>ICE が接続に成功すると、WebRTC は暗号化トランスポートの確立に進みます。このトランスポートは、音声、ビデオ、データに使用されます。</p><h3 id=dtls-と-srtp-によるトランスポート層のセキュリティ確保>DTLS と SRTP によるトランスポート層のセキュリティ確保
<a class=anchor href=#dtls-%e3%81%a8-srtp-%e3%81%ab%e3%82%88%e3%82%8b%e3%83%88%e3%83%a9%e3%83%b3%e3%82%b9%e3%83%9d%e3%83%bc%e3%83%88%e5%b1%a4%e3%81%ae%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e7%a2%ba%e4%bf%9d>#</a></h3><p>ICE による双方向通信が可能になったところで、安全な通信を確立する必要があります。これには、WebRTC よりも古い 2 つのプロトコルを使用します。1 つ目のプロトコルは DTLS（Datagram Transport Layer Security）で、これは UDP 上の TLS に過ぎません。TLS は、HTTPS での通信を保護するために使用される暗号化プロトコルです。2 つ目のプロトコルは SRTP（Secure Real-time Transport Protocol）です。</p><p>まず、WebRTC は ICE で確立された接続の上で DTLS ハンドシェイクを行って接続します。HTTPS とは異なり、WebRTC は証明書に中央機関を使用しません。代わりに、WebRTC は、DTLS を通じて交換された証明書が、シグナリングによって共有されたフィンガープリントと一致することを表明します。この DTLS 接続は、DataChannel メッセージに使用されます。</p><p>WebRTC は、RTP と呼ばれるオーディオ／ビデオ伝送用の別のプロトコルを使用します。RTP パケットのセキュリティには SRTP を使用します。SRTP セッションは、ネゴシエートされた DTLS セッションからキーを抽出して初期化します。後の章では、メディア伝送に独自のプロトコルが必要な理由について説明します。</p><p>これで完了です。双方向の安全な通信が可能になりました。WebRTC エージェント間の接続が安定していれば、これ以上の複雑な作業は必要ありません。しかしながら、現実の世界ではパケットロスや帯域幅の制限があるため、WebRTC エージェントがそれらに対処する方法を次のセクションで説明します。</p><h3 id=rtp-および-sctp-によるピアとの通信>RTP および SCTP によるピアとの通信
<a class=anchor href=#rtp-%e3%81%8a%e3%82%88%e3%81%b3-sctp-%e3%81%ab%e3%82%88%e3%82%8b%e3%83%94%e3%82%a2%e3%81%a8%e3%81%ae%e9%80%9a%e4%bf%a1>#</a></h3><p>これで 2 つの WebRTC Agent が安全な双方向通信を行うことができました。それでは早速、通信を開始しましょう。ここでも、既存の 2 つのプロトコルを使用します。RTP（Real-time Transport Protocol）と SCTP（Stream Control Transmission Protocol）です。SRTP で暗号化されたメディアのやり取りにはRTPを、DTLS で暗号化された DataChannel メッセージの送受信には SCTP を使用します。</p><p>RTP は最小限の機能しか備えていませんが、リアルタイムストリーミングを実現するために必要な機能を備えています。重要なのは、RTP が開発者に柔軟性を与えていることで、開発者はレイテンシー、ロス、輻輳を思い通りに処理できます。この点については、「メディア」の章で詳しく説明します。</p><p>スタックの最後のプロトコルは SCTP です。SCTP では、メッセージの配信オプションが多数用意されています。オプションで、信頼性のない、順番のない配信を選択できますので、リアルタイムシステムに必要なレイテンシーを得ることができます。</p><h2 id=プロトコルの集合体であるwebrtc>プロトコルの集合体であるWebRTC
<a class=anchor href=#%e3%83%97%e3%83%ad%e3%83%88%e3%82%b3%e3%83%ab%e3%81%ae%e9%9b%86%e5%90%88%e4%bd%93%e3%81%a7%e3%81%82%e3%82%8bwebrtc>#</a></h2><p>WebRTC は多くの問題を解決していて、一見過剰な技術とさえ思えるかもしれません。しかし、WebRTC のとてもすばらしいところは、実に謙虚だというところです。WebRTC は、自前ですべてをうまく解決できるとは考えませんでした。その代わり、多くの既存の単一目的の技術を採用し、それらを束ねることにしました。</p><p>これにより、私たちは圧倒されることなく、各部分を個別に検討し、学ぶことができるのです。「WebRTC エージェント」とは、実際には多くの異なるプロトコルを組み合わせたものに過ぎないということです。</p><p><img src=../../images/01-webrtc-agent.png alt="WebRTC Agent" title="WebRTC Agent Diagram"></p><h2 id=webrtc-api-はどのように動作するか>WebRTC (API) はどのように動作するか
<a class=anchor href=#webrtc-api-%e3%81%af%e3%81%a9%e3%81%ae%e3%82%88%e3%81%86%e3%81%ab%e5%8b%95%e4%bd%9c%e3%81%99%e3%82%8b%e3%81%8b>#</a></h2><p>このセクションでは、JavaScript の API がプロトコルにどのように対応するかを示します。これは、WebRTC API の広範なデモを意味するものではなく、すべてがどのように結びついているかのメンタルモデルを作成するためのものです。
どちらにも慣れていない方でも問題ありません。このセクションは、より多くのことを学ぶために戻ってくる楽しみがあるかもしれません。</p><h3 id=new-rtcpeerconnection><code>new RTCPeerConnection</code>
<a class=anchor href=#new-rtcpeerconnection>#</a></h3><p><code>RTCPeerConnection</code> は、トップレベルの「WebRTC セッション」です。これには上述のすべてのプロトコルが含まれています。サブシステムはすべて割り当てられていますが、まだ何も起こりません。</p><h3 id=addtrack><code>addTrack</code>
<a class=anchor href=#addtrack>#</a></h3><p><code>addTrack</code> は新しい RTP ストリームを作成します。このストリームには、ランダムな同期ソース (SSRC) が生成されます。このストリームは、メディアセクション内の <code>createOffer</code> で生成された Session Description の中に入ります。 <code>addTrack</code> を呼び出すたびに、新しい SSRC とメディアセクションが作成されます。</p><p>SRTP セッションが確立されるとすぐに、これらのメディアパケットは SRTP で暗号化された後、ICE 経由で送信され始めます。</p><h3 id=createdatachannel><code>createDataChannel</code>
<a class=anchor href=#createdatachannel>#</a></h3><p><code>createDataChannel</code> は、SCTP アソシエーションが存在しない場合に、新しい SCTP ストリームを作成します。デフォルトでは、SCTP は有効ではなく、一方の側がデータチャネルを要求したときにのみ開始されます。</p><p>DTLS セッションが確立された直後に、SCTP アソシエーションは ICE を経由して DTLS で暗号化されたパケットの送信を開始します。</p><h3 id=createoffer><code>createOffer</code>
<a class=anchor href=#createoffer>#</a></h3><p><code>createOffer</code> は、リモートピアと共有するローカルステートの Session Description を生成します。</p><p><code>createOffer</code> を呼び出しても、ローカルピアは何も変わりません。</p><h3 id=setlocaldescription><code>setLocalDescription</code>
<a class=anchor href=#setlocaldescription>#</a></h3><p><code>setLocalDescription</code> は要求されたすべての変更をコミットします。<code>addTrack</code>, <code>createDataChannel</code> などの呼び出しは、この呼び出しまではすべて一時的なものです。 <code>setLocalDescription</code> は <code>createOffer</code> で生成された値で呼び出されます。</p><p>通常、この呼び出しの後、リモートピアにオファーを送信し、リモートピアはそれを使って <code>setRemoteDescription</code> を呼び出します。</p><h3 id=setremotedescription><code>setRemoteDescription</code>
<a class=anchor href=#setremotedescription>#</a></h3><p><code>setRemoteDescription</code> は、リモート候補の状態をローカルエージェントに通知する方法です。これは、JavaScript の API で「シグナリング」をする方法です。</p><p>双方で <code>setRemoteDescription</code> が呼び出されると、WebRTC エージェントは P2P 通信を開始するのに十分な情報を得ることができます!</p><h3 id=addicecandidate><code>addIceCandidate</code>
<a class=anchor href=#addicecandidate>#</a></h3><p><code>addIceCandidate</code> を使うと、WebRTC エージェントはいつでも好きなときにリモートの ICE 候補を追加できます。この API は ICE サブシステムに ICE Candidate を直接送信し、大規模な WebRTC 接続には他の影響を与えません。</p><h3 id=ontrack><code>ontrack</code>
<a class=anchor href=#ontrack>#</a></h3><p><code>ontrack</code> は、リモートピアから RTP パケットを受信したときに起動されるコールバックです。受信パケットは、<code>setRemoteDescription</code> に渡された Session Description で宣言されているはずです。</p><p>WebRTC は SSRC を使用して、関連する <code>MediaStream</code> と <code>MediaStreamTrack</code> を検索し、これらの詳細が入力された状態でこのコールバックを起動します。</p><h3 id=oniceconnectionstatechange><code>oniceconnectionstatechange</code>
<a class=anchor href=#oniceconnectionstatechange>#</a></h3><p><code>oniceconnectionstatechange</code> は、ICE エージェントの状態を反映して起動されるコールバックです。ネットワークに接続されたときや、切断されたときに、このように通知されます。</p><h3 id=onconnectionstatechange><code>onconnectionstatechange</code>
<a class=anchor href=#onconnectionstatechange>#</a></h3><p><code>onconnectionstatechange</code> は、ICE エージェントと DTLS エージェントの状態を組み合わせたものです。これを見ることで、ICE と DTLS の両方が正常に完了したときに通知を受けることができます。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/webrtc-for-the-curious/webrtc-for-the-curious/commit/4106247124e69adde33201040121d636951d6675 title='最終更新者 Pang | 2月 24, 2022' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt>
<span>2月 24, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/webrtc-for-the-curious/webrtc-for-the-curious/edit/master/content/docs/01-what-why-and-how.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt>
<span>このページを編集する</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#webrtcとは>WebRTCとは？</a></li><li><a href=#なぜwebrtcを学ぶ必要があるのか>なぜWebRTCを学ぶ必要があるのか？</a></li><li><a href=#webrtcプロトコルは他の技術の集合体である>WebRTCプロトコルは他の技術の集合体である</a><ul><li><a href=#シグナリング-webrtcでピアがお互いを見つける方法>シグナリング: WebRTCでピアがお互いを見つける方法</a></li><li><a href=#stunturn-による接続と-nat-トラバーサル>STUN/TURN による接続と NAT トラバーサル</a></li><li><a href=#dtls-と-srtp-によるトランスポート層のセキュリティ確保>DTLS と SRTP によるトランスポート層のセキュリティ確保</a></li><li><a href=#rtp-および-sctp-によるピアとの通信>RTP および SCTP によるピアとの通信</a></li></ul></li><li><a href=#プロトコルの集合体であるwebrtc>プロトコルの集合体であるWebRTC</a></li><li><a href=#webrtc-api-はどのように動作するか>WebRTC (API) はどのように動作するか</a><ul><li><a href=#new-rtcpeerconnection><code>new RTCPeerConnection</code></a></li><li><a href=#addtrack><code>addTrack</code></a></li><li><a href=#createdatachannel><code>createDataChannel</code></a></li><li><a href=#createoffer><code>createOffer</code></a></li><li><a href=#setlocaldescription><code>setLocalDescription</code></a></li><li><a href=#setremotedescription><code>setRemoteDescription</code></a></li><li><a href=#addicecandidate><code>addIceCandidate</code></a></li><li><a href=#ontrack><code>ontrack</code></a></li><li><a href=#oniceconnectionstatechange><code>oniceconnectionstatechange</code></a></li><li><a href=#onconnectionstatechange><code>onconnectionstatechange</code></a></li></ul></li></ul></nav></div></aside></main></body></html>